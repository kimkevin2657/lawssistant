/*
	Copyright (c) 2014 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};
	CRD.Slideshow=function(aa,I,J){function K(a){$.each(a,function(a,b){c[a]=b});L="undefined"!==typeof c.isTouch?!!c.isTouch:"ontouchstart"in window||navigator.msPointerEnabled||window.DocumentTouch&&document instanceof DocumentTouch}function n(){c.isManual||(M=u(function(){p()},c.interval))}function x(){clearTimeout(N);clearTimeout(M)}function u(a,b){return setTimeout(a,b||0)}function O(a){p.call(this,a,{isPrev:!1})}function P(a){p.call(this,a,{isPrev:!0})}function p(a,f){var d=b.index,Q=c.isCarousel?
	c.time:0;if(!q&&(r=f&&f.isPrev,ba.call(this,f&&f.slide),!b.slide.is(b.slideNext))){var e=J?J.call(b,a):!0;if(e||"undefined"===typeof e)q=!0,x(),a&&"hashchange"===a.type&&(Q=0),v(B(d),Q,function(){R(a)})}a?a.preventDefault():n()}function v(a,f,d,e){function g(){C=!1;a||0===a||(a=B(b.index));f=f||0;if(ca&&c.isCarousel){e=e||0;if(f&&d)l.one(k.toLowerCase()+"TransitionEnd transitionend",d);y[k+"Transition"]=f?f/1E3+"s":"";y[k+"Transform"]="translateX("+-1*(z(a,!0)-e)+"%)";!f&&d&&d()}else l.stop(!0,!0).animate({left:z(a)+
	"%"},f,d)}S&&"undefined"!==typeof e?(C=!0,T=requestAnimationFrame(g)):g()}function R(a){b.slide=b.slideNext;q=!1;h.removeClass(c.classActive);b.slide.addClass(c.classActive);y[k+"Transition"]="";c.canLoop&&U();V();a&&("click"!==a.type&&"hashchange"!==a.type||u(function(){b.slide.focus()}),I&&I.call(b,a))}function ba(a){var f=$(this),d=b.index,g=e-1,f=f.is(w)?c.step:1;"undefined"!==typeof a?(r=a<d?!0:!1,d=a):r?(d-=f,d=0>=d?c.canLoop?m(d):0:d):(d+=f,d=d>=g?c.canLoop?m(d):g:d);b.slideNext=h.eq(d);b.index=
	d}function W(){return!c.canLoop&&(r&&0===b.index||!r&&b.index===e-1)}function X(a){t&&(a?p.call(this,a,{slide:D.index(this)}):D.removeAttr("class").eq(b.index).addClass(c.classActive))}function V(){var a,f=c.classDisabled;if(!c.canLoop){w.removeClass(f);switch(b.index){case 0:a=E;break;case e-1:a=F}a&&a.addClass(f)}X()}function z(a,b){return b?100/e*a:-100*a}function m(a){a>=e&&(a-=e);0>a&&(a=e+a);return a}function B(a){return m(b.index+(c.canLoop?A-a:0))}function Y(a){return m(c.canLoop?a-A+b.index:
	a)}function Z(a){var f,d;b.slide||(b.slide=h.filter("."+c.classActive).first(),b.index=h.index(b.slide));location.hash&&(f=h.filter(location.hash),d=h.index(f),f.length&&b.index!==d&&p(a,{slide:d}));b.slide.length||(b.index=0,b.slide=h.eq(b.index));u(function(){g.scrollTop(0);g.scrollLeft(0)})}function U(){for(var a=e,f,d,g;a--;)f=h.eq(Y(a)),d=f.data("x"),g=z(a,!0)+"%",g!==d&&f.css({left:g,display:c.display}).attr("tabindex","-1").data("x",g);v(c.canLoop?A:b.index)}function da(){var a,f;function d(d){var g=
	d.originalEvent,h=g.touches&&g.touches[0]||g;C||1<h.length||g.scale&&1!==g.scale||(a=(h.pageX||h.screenX)-k.x,f=(h.pageY||h.screenY)-k.y,"undefined"===typeof s&&(s=!!(s||Math.abs(a)<Math.abs(f))),s||(d.preventDefault(),x(),r=0<a,q=!0,!c.canLoop&&W()&&(a/=Math.abs(a)/b.width+1),v(null,null,null,a/b.width*(100/e))))}function h(){if(!s){var f=+new Date-k.time,e=Math.abs(a),f=250>f&&20<e||e>b.width/3;q=!1;S&&cancelAnimationFrame(T);f&&!W()?p.call(this,event,{isPrev:r}):0<e&&v(null,c.time)}g.off(m,d);
	g.off(n,h)}function l(a){G&&clearTimeout(G);G=u(function(){b.width=g.outerWidth()},a?300:0)}var k,m="touchmove pointermove MSPointerMove",n="touchend touchleave touchcancel MSPointerUp MSPointerOut MSPointerCancel pointerup pointerleave pointercancel";c.isCarousel=!0;g.on("touchstart pointerdown MSPointerDown",function(b){var c=w||t&&t.add(w),e=b.originalEvent,e=e.touches&&e.touches[0]||e;c.has(b.target).length||c.is(b.target)||(q&&R(),k={x:e.pageX||e.screenX,y:e.pageY||e.screenY,time:+new Date},
	s=f=a=void 0,g.on(m,d),g.on(n,h))}).on("click",function(a){!s&&q&&a.preventDefault()}).addClass(c.classTouch);l();$(window).resize(l)}var b=this,H=["ms","O","Moz","Webkit",""],k="",y,c={next:"button.next",previous:"button.previous",markers:".markers",classStrip:"strip",classSlide:"slide",classActive:"sticky",classDisabled:"disabled",classTouch:"touch",step:1,delay:3E3,interval:5E3,time:400,display:"block",canLoop:!1,isManual:!0,isCarousel:!0},g,h,l,t,D,w,E,F,N,M,G,T,e,A,q,C,s,r,L,ca=function(){for(var a=
	document.body.style,b=H.length;b--;)if("string"===typeof a[H[b]+"Transition"]){k=H[b];break}return!!k}(),S=!(!window.requestAnimationFrame||!window.cancelAnimationFrame);K(aa||{});b.init=function(){g=$(c.slideshow);h=g.find("."+c.classSlide);l=g.find("."+c.classStrip);e=h.length;if(g.length&&!(2>e)){y=l[0].style;l.outerWidth(100*e+"%");h.outerWidth(100/e+"%");h.first().width()||h.width(100/e+"%");A=c.canLoop?Math.floor((e-1)/2):0;g.mouseenter(x).mouseleave(n);F=$(c.next).on("click touchend",O);E=
	$(c.previous).on("click touchend",P);w=E.add(F);N=u(n,c.delay);if(c.markers){t=$(c.markers).on("click touchend","button",X);for(var a=e;a--;)t.prepend($("<button>"+(a+1)+"</button>"));D=t.find("button")}Z();U();L&&da();V();b.element=g;b.strip=l;b.slides=h;g.removeClass(c.classDisabled);$(window).on("hashchange",Z)}};b.start=n;b.stop=x;b.next=O;b.prev=P;b.change=p;b.transition=v;b.getTransitionX=z;b.getIndexWrapped=m;b.getIndexOffset=B;b.getPositionOffset=Y;b.updateConfig=K};
